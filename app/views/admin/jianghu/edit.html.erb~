<div id="middle" xmlns="http://www.w3.org/1999/html">
  <%= form_tag("/admin/jianghu/#{@jianghu.id}", :method => 'put', :multipart => true) do %>
      <table class="tabinfo">
        <%
           is_finish = ''
           if @jianghu.is_finish == false
             is_finish = '未完成'
           else
             is_finish = '已完成'
           end
        %>
        <tr>
          <th>是否完成</th>
          <td>
            <select id="is_finish" name="jianghu[is_finish]">
              <% @is_finish.each() do |v| %>
                  <option value=<%= "\"#{v}\"".html_safe %>><%= v %></option>
              <% end %>
            </select>
          </td>
        </tr>
        <tr>
          <th>场景</th>

          <td>
            <select id="scene_name" name="scene_name" onchange="changeselect1(this.value)">
              <% @scene_names.each() do |s| %>
                  <% if @names_config[@jh_config[@jianghu.scene_id]["name"]] == s %>
                      <option selected="selected" value=
                      <%= "\"#{s}\"".html_safe %>>
                        <%= s %></option>
                  <% else %>
                      <option value=<%= "\"#{s}\"".html_safe %>>
                        <%= s %></option>
                  <% end %>
              <% end %>
            </select>
          </td>
        </tr>
        <tr>
          <th>条目</th>
          <td>
            <select id="item_id" name="jianghu[item_id]" >
              <% @jh_config[@jianghu.scene_id]["items"].each() do |item| %>
                  <% if @jh_config[@jianghu.scene_id]["items"][@jianghu.item_id - 1]["name"] ==
                          item["name"] %>
                      <option selected="selected" value=
                      <%= "\"#{@names_config[item["name"]]}\"".html_safe %>>
                        <%= @names_config[item["name"]] %></option>
                  <% elsif !item["name"].nil? %>
                      <option value=<%= "\"#{@names_config[item["name"]]}\"".html_safe %>>
                        <%= @names_config[item["name"]] %></option>
                  <% end %>
              <% end %>
            </select>
          </td>
        </tr>
        <tr>
          <th>战斗次数</th>
          <td><%= text_field(:jianghu, :fight_time) %>
            <% if @jianghu.errors['fight_time'] && @jianghu.errors['fight_time'].length > 0 %>
                <span style="color: red;">场景输入不合法。</span>
            <% end %>
          </td>
        </tr>
        <tr>
          <th>星级</th>
          <td><%= text_field(:jianghu, :star) %>
            <% if @jianghu.errors['star'] && @jianghu.errors['star'].length > 0 %>
                <span style="color: red;">场景输入不合法。</span>
            <% end %>
          </td>
        </tr>
      </table>
    <input type="submit" value="更新江湖" class="btnsubmit"/>
  <% end %>
  <form id="submit_form" name="submit_form" >
    <script language="javascript">
//        <!--
//        var scene_names = new Array("初出茅庐", "桃园结义", "挑战吕布", "讨伐董卓", "火烧赤壁", "北伐曹操", "七出岐山", "合肥会战", "英雄大会", "白衣渡江");
//        var item_names = new Array();
//        item_names[0] = new Array(0, "战斗条目1101");
//        item_names[1] = new Array(0, "战斗条目1102");
//        item_names[2] = new Array(0, "战斗条目1103");
//        item_names[3] = new Array(1, "战斗条目1201");
//        item_names[4] = new Array(1, "战斗条目1202");
//        item_names[5] = new Array(1, "战斗条目1203");
//        item_names[6] = new Array(2, "战斗条目1301");
//        item_names[7] = new Array(2, "战斗条目1302");
//        item_names[8] = new Array(2, "战斗条目1303");
//        item_names[9] = new Array(2, "战斗条目1304");
        $(document).ready(function(){
            $.getJSON("/admin/jianghu/scene_names",function(data,status){
 					  var names = data['data'] 
	              for(i=0;i<names.length;i++){
							document.submit_form.bigclass.options[i] = new Option(names[i]);
							if(names[i] == document.submit_form.bigclassSelected.value){
								document.submit_form.bigclass.options[i].selected = 'selected';
							}									
					}
           			 });
				$.getJSON("/admin/jianghu/item_names",function(data,status){
 					  var names = data['data'] 
	              for(i=0;i<names.length;i++){
							document.submit_form.bigclass.options[i] = new Option(names[i]);
							if(names[i] == document.submit_form.smallclassSelected.value){
								document.submit_form.smallclass.options[i].selected = 'selected';
							}									
					}
           			 });
        });
//        function changeselect1(locationid)
//        {
//            for(j=0;j<scene_names.length;j++)
//                if(scene_names[j]==locationid){
//                    locationid=j;
//                }
//            document.submit_form.smallclass.length=0;//初始化下拉列表，清空下拉数据
////            document.submit_form.smallclass.options[0]=new Option('所有小类','所有小类');//给第一个值
//            for(i=0;i<item_names.length;i++)
//            {
//                if(item_names[i][0]==locationid)
//                {
//                    document.submit_form.smallclass.options[document.submit_form.smallclass.length]=new Option(item_names[i][1]);}//建立option
//            }
//        }
        //-->
    </script>
	 <input type="hidden" name="bigclassSelected" value=<%=@names_config[@jh_config[@jianghu.scene_id]["name"]]%> /> 
    <select name="bigclass" id ="bigclass" onchange="changeselect1(this.value)">
    </select>
	 <input type="hidden" name="smallclassSelected" value=<%=@jh_config[@jianghu.scene_id]["items"][@jianghu.item_id - 1]["name"]%> /> 
    <select name="smallclass">
    </select>
  </form>
</div>
